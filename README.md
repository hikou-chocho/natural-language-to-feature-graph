# ============================================================

# **AI主導の自然言語CAD システム仕様書（概要）**

# ============================================================

## ■ 1. 製品コンセプト

### **製品名（仮）：NL-CAD / AI-Driven FeatureCAD**

本プロダクトは、
**自然言語（テキスト / 音声）を主入力として設計意図を取得し、
AIが主導して 3Dモデル（STEP/STL）を生成する次世代CAD**
である。

従来のCAD/CAMが前提としていた「大量のボタン操作・コマンド知識」を不要とし、
**会話ベースでフィーチャ定義 → 形状生成 → 出力**まで行う。

中心概念は「FeatureGraph（FG）」。
AIは自然言語を解析し、FG という抽象モデルに変換する。
FG は L0（パラメトリック構造）へ落とし込まれ、
CadQuery 等のバックエンドで 3D形状へ変換される。

---

## ■ 2. 主要特徴（USP）

### **① “命令” ではなく “設計意図” を扱う CAD**

Fusion 360 / NX の自然言語は
「操作コマンドを自然言語で言うだけ」だが、
本製品は **自然言語 → 意図モデル（FeatureGraph）** を生成する。

### **② UIを最小化した “AI主導UI”**

* メインは 3Dビュー
* 下部に自然言語入力欄
* 必要なときのみ補助UI（面選択など）を表示
* AIが常に「次に言うべきこと」を提示

### **③ データ構造が外部アプリと結合可能**

生成される FeatureGraph (JSON) は以下の用途に再利用可能：

* 設計自動化
* CAM自動生成
* 設計仕様書
* バージョン管理
* API連携／Webサービス化

### **④ 加工も見据えたAP238系フィーチャ体系**

FeatureGraph は AP238・AP224・ISO14649を参考に
最大23種のフィーチャをサポート（穴・ポケット・輪郭・旋盤形状など）。

### **⑤ CadQuery（または他バックエンド）で形状を確実に再生**

LLMが曖昧でも、
**L0中間形式が存在するため、変換誤差が少なく再現性が高い。**

---

## ■ 3. システム全体アーキテクチャ

```
┌────────────────────────────┐
│          ユーザー（会話）                              │
│   「直径50の円柱から上面に直径10の穴を貫通で」         │
└───────────────┬────────────────────┘
                    │ 自然言語
                    ▼
        ┌────────────────────────┐
        │ ① 素材抽出LLM（Stock Extractor）               │
        └────────────────────────┘
                    ▼ Stock JSON

        ┌────────────────────────┐
        │ ② フィーチャ抽出LLM（Feature Extractor）       │
        └────────────────────────┘
                    ▼ FeatureGraph JSON（未補完）

        ┌────────────────────────┐
        │ ③ UI補助（加工面選択 / 位置補完など）          │
        └────────────────────────┘
                    ▼ 完全な FeatureGraph JSON

        ┌────────────────────────┐
        │ ④ L0変換器（Parametric Constraint Resolver）   │
        └────────────────────────┘
                    ▼ L0 Model

        ┌────────────────────────┐
        │ ⑤ CadQuery Backend（生成エンジン）             │
        └────────────────────────┘
                    ▼ 3Dモデル（B-Rep）

        ┌────────────────────────┐
        │ ⑥ 出力（STEP / STL）                           │
        └────────────────────────┘
```

---

## ■ 4. モジュール仕様

---

### 4.1 ① 素材抽出LLM

**入力：** 自然言語
**出力：**

```json
{
  "stock": {
    "type": "block" | "cylinder",
    "params": { ... }
  }
}
```

**役割：**

* 寸法NER（50×30×20 → 数値化）
* 形状選別（円柱 / 直方体）
* 単純で高精度（95〜98%）

---

### 4.2 ② フィーチャ抽出LLM

**入力：自然言語（素材は既知）**
**出力：FeatureGraph の operations[]**

例：

```json
{
  "op": "drill:hole",
  "params": { "dia": 10, "depth": 20, "x": 0, "y": 0 }
}
```

役割：

* フィーチャ種類（23種）の分類
* 寸法NER
* 複数フィーチャの抽出
* 加工平面は推定しない（後述UIで補う）

---

### 4.3 ③ UI補助コンポーネント

**理念：最小限のUIで、曖昧性を人間が埋める。**

機能：

* 加工平面の選択（上/右/前など）
* 不完全な寸法の補完
* AIの指示：

  * 「どの面に穴をあけますか？」
  * 「位置が不明です、中心でよいですか？」

目的：

* LLMに過負荷を与えず正確性を担保
* 完全自動ではなく“半自動”で信頼性を高める

---

### 4.4 ④ L0変換器（Parametric Resolver）

FeatureGraph → L0 パラメトリック表現へ変換。

機能：

* 3D座標計算
* 加工平面 → ワーク座標系変換
* ロフト/押し出しの一致性チェック
* エラー時の再要求メッセージ生成

---

### 4.5 ⑤ CadQuery Backend

L0から確実に形状を構築するバックエンド。

* スケッチ/押し出し/旋盤/ブールなど
* API経由でSTEP/STLとして出力
* 不整合を検出してUIへ返却（例：負の厚み）

---

### 4.6 ⑥ 出力モジュール

* STEP AP203/AP214
* STL
* 追加で：glTF for web preview

---

## ■ 5. UX設計（UI）

### 5.1 画面構成

* **中央：3Dビュー（回転・ズーム）**
* **下部：自然言語入力バー（文字/音声）**
* **右側：FeatureGraphビュー（自動更新）**
* **ヘルプ：AIが状況に応じてヒント表示**

### 5.2 ワークフロー

1. AIが最初のヒント
   「まず素材を作りましょう。例：50×30×20のブロック。」

2. ユーザーが自然言語で入力

3. AIが素材生成 → 画面に表示

4. AIが次のヒント
   「どんな加工をしたいですか？」

5. ユーザーが自然言語で操作

6. 曖昧なところはUIに質問

7. モデル完成 → STEP/STL出力

---

## ■ 6. 競合との差別化

### ✔ 自然言語 → “設計意図（FeatureGraph）” を生成

Fusion/NXは自然言語 → 操作コマンド。

### ✔ UI は“操作ツール”ではなく“AIとの会話空間”

ボタン地獄を廃止できる。

### ✔ モデルを外部に渡せる（API化可能）

FeatureGraphは純JSONで他サービスでも扱える。

### ✔ 製造（CAM）に接続する準備が整っている

AP238フィーチャ定義に準拠。

---

## ■ 7. 利用対象

* 設計初心者
* CAMオペレータ（ラフな3Dモデルが必要）
* 営業（簡易モデル作成）
* 教育用途（会話しながらCADを学ぶ）
* 自動設計・自動見積もりのバックエンド

---

## ■ 8. 今後の発展性

1. フィーチャ自動認識（既存STEP→FeatureGraph）
2. CAM自動化（FeatureGraph→Toolpath）
3. 設計の自動最適化（寸法提案）
4. 音声モデルとの融合（「話すCAD」）
5. Web版（ブラウザだけでCADが動く）
